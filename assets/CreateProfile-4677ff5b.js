import{l as F,u as I,r as k,b as s,F as E,j as e,B as j,L as q,a as N,m as G,R as A}from"./index-faffc295.js";import{D as b}from"./index-e8365e54.js";import{G as B}from"./GetCollegeList-9a53f69e.js";import{G as M}from"./GetDeptList-df454fd9.js";import{G as U}from"./GetRolesList-bf5465db.js";const J=()=>{const{username:x}=F(),C=I(),[P,y]=k.useState(!1),u=B(),h=M(),g=U(),[l,w]=k.useState({staffId:"",name:"",phone:"",staffRole:"",selectedCollege:"",selectedDepartment:"",profilePhoto:null}),[o,c]=k.useState({staff_id:"",staff_role:"",name:"",phone:"",college:"",department:"",image:"",user:""}),d=a=>{c({staff_id:"",staff_role:"",name:"",phone:"",college:"",department:"",image:"",user:""});const{name:r,value:t}=a.target;w(p=>({...p,[r]:t}))},_=a=>{var t;const r=(t=a.target.files)==null?void 0:t[0];if(r&&r.type.startsWith("image/")){const p=new FileReader;p.onload=D=>{var v;const m=new Image;m.src=(v=D.target)==null?void 0:v.result,m.onload=()=>{const f=document.createElement("canvas"),i=f.getContext("2d");if(i){const n=Math.min(m.width,m.height);f.width=n,f.height=n,i.beginPath(),i.arc(n/2,n/2,n/2,0,2*Math.PI),i.closePath(),i.clip(),i.drawImage(m,0,0,n,n),f.toBlob(L=>{const R=new File([L],r.name,{type:"image/jpeg"});w(S=>({...S,profilePhoto:R}))},"image/jpeg")}else console.error("Canvas context is null")}},p.readAsDataURL(r)}else r&&!r.type.startsWith("image/")?c({...o,image:r.type+" is not a valid image"}):(r==null?void 0:r.size)!==void 0&&r.size>2*1024*1024&&c({...o,image:"File size must be less than 2 MB"})},z=async a=>{a.preventDefault(),y(!0);const r=new FormData;if(x){r.append("user",x),r.append("staff_id",l.staffId),r.append("name",l.name),r.append("staff_role",l.staffRole),r.append("phone",l.phone),r.append("college",l.selectedCollege),r.append("department",l.selectedDepartment),l.profilePhoto?r.append("image",l.profilePhoto):r.append("image","");try{const t=await N.post(`${G}`,r,{...A()});console.log(t),t.status===201&&(c({staff_id:"",staff_role:"",name:"",phone:"",college:"",department:"",image:"",user:""}),window.alert("Registered user "+r.get("user")+" Successfully!"),C("/dashboard/users"))}catch(t){N.isAxiosError(t)&&t.response?t.response.status===400?c({staff_id:t.response.data.staff_id||"",staff_role:t.response.data.staff_role||"",name:t.response.data.name||"",phone:t.response.data.phone||"",college:t.response.data.college||"",department:t.response.data.department||"",image:t.response.data.image||"",user:t.response.data.user||""}):console.error("An error occurred:",t.message):console.error("An unexpected error occurred:",t)}finally{y(!1)}}};return s(E,{children:[e(j,{pageName:"CreateProfile"}),e("div",{className:"grid grid-cols-1 gap-9 sm:grid-cols-1",children:s("div",{className:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark",children:[e("div",{className:"border-b border-stroke py-4 px-6.5 dark:border-strokedark",children:s("h3",{className:"font-medium text-black dark:text-white",children:["Create Profile"," ",o.user&&e("span",{style:{color:"red"},className:"flex items-center font-medium text-red tracking-wide text-red-500 text-xs mt-1 ml-1",children:o.user})]})}),e("form",{action:"",onSubmit:z,children:P?e(q,{}):s("div",{className:"p-6.5",children:[s("div",{className:"mb-4.5",children:[e("label",{className:"mb-2.5 block text-black dark:text-white",children:"Staff ID"}),e("input",{type:"text",name:"staffId",onChange:d,placeholder:"Enter Staff ID",className:`w-full rounded border-[1.5px] border-stroke bg-transparent py-3 px-5 font-medium outline-none transition focus:border-primary 
                    placeholder-gray-500
                    active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary`,required:!0}),o.staff_id&&e("span",{style:{color:"red"},className:"flex items-center font-medium  tracking-wide text-red-500 text-xs mt-1 ml-1",children:o.staff_id})]}),s("div",{className:"mb-4.5",children:[e("label",{className:"mb-2.5 block text-black dark:text-white",children:"Name"}),e("input",{type:"text",name:"name",onChange:d,placeholder:"Enter full name",className:`w-full rounded border-[1.5px] border-stroke bg-transparent py-3 px-5 font-medium outline-none transition focus:border-primary 
                    placeholder-gray-500
                    active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary`,required:!0}),o.name&&e("span",{style:{color:"red"},className:"flex items-center font-medium text-red tracking-wide text-red-500 text-xs mt-1 ml-1",children:o.name})]}),s("div",{className:"mb-4.5",children:[e("label",{className:"mb-2.5 block text-black dark:text-white",children:"Select Role"}),s("div",{className:"relative z-20 bg-white dark:bg-form-input",children:[e("span",{className:"absolute top-1/2 left-4 z-30 -translate-y-1/2",children:b()}),s("select",{onChange:d,name:"staffRole",className:"relative z-20 w-full appearance-none rounded border border-stroke bg-transparent py-3 px-12 outline-none transition focus:border-primary active:border-primary dark:border-form-strokedark dark:bg-form-input",required:!0,children:[e("option",{value:"",children:"select"}),g==null?void 0:g.map(a=>e("option",{value:a.id,children:a.name},a.id))]}),e("span",{className:"absolute top-1/2 right-4 z-10 -translate-y-1/2",children:e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e("g",{opacity:"0.8",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.29289 8.29289C5.68342 7.90237 6.31658 7.90237 6.70711 8.29289L12 13.5858L17.2929 8.29289C17.6834 7.90237 18.3166 7.90237 18.7071 8.29289C19.0976 8.68342 19.0976 9.31658 18.7071 9.70711L12.7071 15.7071C12.3166 16.0976 11.6834 16.0976 11.2929 15.7071L5.29289 9.70711C4.90237 9.31658 4.90237 8.68342 5.29289 8.29289Z",fill:"#637381"})})})})]}),o.staff_role&&e("span",{style:{color:"red"},className:"flex items-center font-medium text-red tracking-wide text-red-500 text-xs mt-1 ml-1",children:o.staff_role})]}),s("div",{className:"mb-4.5",children:[e("label",{className:"mb-2.5 block text-black dark:text-white",children:"Phone"}),e("input",{type:"text",name:"phone",onChange:d,placeholder:"Enter phone number",className:`w-full rounded border-[1.5px] border-stroke bg-transparent 
                    placeholder-gray-500
                    py-3 px-5 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary`,required:!0,maxLength:10,minLength:10}),o.phone&&e("span",{style:{color:"red"},className:"flex items-center font-medium text-red text-red tracking-wide  text-xs mt-1 ml-1",children:o.phone})]}),s("div",{className:"mb-4.5",children:[e("label",{className:"mb-2.5 block text-black dark:text-white",children:"Select College *"}),s("div",{className:"relative z-20 bg-white dark:bg-form-input",children:[e("span",{className:"absolute top-1/2 left-4 z-30 -translate-y-1/2",children:b()}),s("select",{onChange:d,name:"selectedCollege",className:"relative z-20 w-full appearance-none rounded border border-stroke bg-transparent py-3 px-12 outline-none transition focus:border-primary active:border-primary dark:border-form-strokedark dark:bg-form-input",children:[e("option",{value:"",children:"select"}),u==null?void 0:u.map(a=>e("option",{value:a.name,children:a.name},a.id))]}),e("span",{className:"absolute top-1/2 right-4 z-10 -translate-y-1/2"})]}),o.college&&e("span",{style:{color:"red"},className:"flex items-center font-medium text-red tracking-wide text-red-500 text-xs mt-1 ml-1",children:o.college})]}),s("div",{className:"mb-4.5",children:[e("label",{className:"mb-2.5 block text-black dark:text-white",children:"Select Department *"}),s("div",{className:"relative z-20 bg-white dark:bg-form-input",children:[e("span",{className:"absolute top-1/2 left-4 z-30 -translate-y-1/2",children:b()}),s("select",{onChange:d,name:"selectedDepartment",className:"relative z-20 w-full appearance-none rounded border border-stroke bg-transparent py-3 px-12 outline-none transition focus:border-primary active:border-primary dark:border-form-strokedark dark:bg-form-input",children:[e("option",{value:"",children:"select"}),h==null?void 0:h.filter(a=>a.college===l.selectedCollege).map(a=>e("option",{value:a.name,children:a.name},a.id))]}),e("span",{className:"absolute top-1/2 right-4 z-10 -translate-y-1/2",children:b()})]}),o.department&&e("span",{style:{color:"red"},className:"flex items-center font-medium text-red tracking-wide text-red-500 text-xs mt-1 ml-1",children:o.department})]}),s("div",{className:"mb-4.5",children:[e("label",{className:"mb-3 block text-black dark:text-white",children:"Upload Profile Photo *"}),e("input",{name:"profilePhoto",type:"file",onChange:_,className:"w-full cursor-pointer rounded-lg border-[1.5px] border-stroke bg-transparent font-medium outline-none transition file:mr-5 file:border-collapse file:cursor-pointer file:border-0 file:border-r file:border-solid file:border-stroke file:bg-whiter file:py-3 file:px-5 file:hover:bg-primary file:hover:bg-opacity-10 focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:file:border-form-strokedark dark:file:bg-white/30 dark:file:text-white dark:focus:border-primary"}),o.image&&e("span",{style:{color:"red"},className:"flex items-center font-medium text-red tracking-wide text-red-500 text-xs mt-1 ml-1",children:o.image})]}),e("button",{type:"submit",className:"flex w-full justify-center rounded bg-primary p-3 font-medium text-white",children:"Finish"})]})})]})})]})};export{J as default};
